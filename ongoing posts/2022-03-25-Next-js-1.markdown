---
layout: post
title: Next.js
subtitle: (1) Next.js는 무엇일까?
img: nextjs.png # Add image post (optional)
tags: [Deployment, AWS, EC2, Frontend, Computer, Web]
category: [Computer/Frontend]
---

## Amazon EC2 (Amazon Elastic Compute Cloud)
***컴퓨터를 임차할 수 있는 서비스***

EC2는 Amazon Web Services(AWS) 클라우드에서 컴퓨팅 용량을 제공하는 웹 서비스다.
쉽게 말해, EC2를 사용하면 컴퓨터 한 대를 임차하는 효과를 얻을 수 있다.

나는 Next.js 기반의 웹 페이지를 배포하기 위해 EC2 서비스를 선택하였다.
처음 EC2 서비스를 이용하려고 페이지에 들어가면 어떤 의미인지 곧바로 파악하기 힘든 단어들이 등장한다.
`인스턴스`, `AMI`, `VPC`, ...

적당히 `EC2를 통해 배포하는 법`을 검색해 대충 배포를 할 수도 있겠지만,
어떤 원리로 배포가 수행되는 것이고,
내가 배포 과정 중에 선택한 것들은 도대체 무슨 의미인지를 알아야
정말로 EC2로 웹 페이지 배포를 할 줄 안다고 말할 수 있지 않겠는가.
그래서 EC2가 정확히 어떤 서비스이고, EC2를 사용하는 이유는 무엇인지, 사용 요금은 얼마인지 등등.
궁금한 것들을 조사해보았다.

---

### 1. AMI와 인스턴스
EC2의 서비스 동작 원리를 이해하는데 가장 중요한 2가지 요소는 `AMI`와 `인스턴스`이다.
내가 임차하는 컴퓨터를 소프트웨어와 하드웨어를 결정하기 떄문이다.

#### (1) AMI (Amazon Machine Image)
EC2를 가구점에 비유한다면, `AMI`는 의자, 침대 등 기본 가구 샘플.
즉, 임차하려고 하는 컴퓨터의 기본 스펙(소프트웨어 구성)이 기재된 템플릿이다.
소프트웨어 구성은 운영 체제, 애플리케이션 서버, 애플리케이션 등을 포함한다.
아래의 사진은 EC2에서 제공하는 `AMI`의 일부이다.

![ec2_ami](/assets/images/post-contents/ec2-ami.png)

`AMI`는 크게 5가지 기준(리전, 운영 체제, 아키텍쳐, 루트 디바이스 저장소 등)에 따라 선택하게 된다.
`리전`과 `루트 디바이스 저장소`는 EC2 내에서 정의되는 개념으로 생소할 수 있는데,
이는 `인스턴스`를 먼저 알아본 뒤에 소개하도록 하겠다.

### (2) 인스턴스
가구점으로 비유를 이어가자면, `인스턴스`는 `AMI`라는 가구 샘플을 선택하여 제공 받은,
실제로 내가 사용할 수 있는 가구이다.
즉, `인스턴스`는 `AMI`의 사본이며 실제로 클라우드에서 실행되는 가상 서버이다.

같은 `AMI`로부터 만든 `인스턴스`라도 서로 다른 `인스턴스 타입`을 부여할 수 있는데,
이 `인스턴스 타입`은 실제로 서버가 돌아갈 호스트 컴퓨터의 하드웨어를 결정한다.
CPU, 메모리, 저장소, 네트워킹 용량 등으로 구성된다.
따라서 인스턴스 사용 목적에 따라 `인스턴스 타입`을 달리 선택해야 한다.
[AWS 사이트](https://aws.amazon.com/ec2/instance-types/)
에서는 `인스턴스 타입`을 특화 기능에 따라 나누어 소개하고 있다.

![ec2-instance-type](/assets/images/post-contents/ec2-instance-type.png)

---

### 2. 리전과 루트 디바이스 저장소

이제 AMI를 선택하는 기준 중 `리전`과 `루트 디바이스 저장소`는 무엇이고,
어떻게 적합한 것을 찾을 수 있는지를 알아보자.

#### (1) 리전 Regions
`리전`은 영단어의 의미 그대로 **개별 지리 영역**을 뜻한다.
EC2는 세계 각지에서 `인스턴스` 호스팅을 진행하고 있는데,
어디에서 호스팅 하느냐에 따라 `리전`이 결정된다.
하나의 AWS 계정으로 여러 개의 `리전`에 접근할 수 있기 떄문에,
`인스턴스`를 만들 때마다 `리전`을 정해줄 수 있다
(AMI 단에서 `리전`을 지정해주어야 한다).

보통은 주 고객층이 위치한 지역과 가까운 곳에 서버를 배치하고자 하거나,
비즈니스에서의 법적 요구사항을 만족시키기 위해서
가장 적합한 `리전`을 찾아 선택한다.   

하나의 `리전`은 `가용 영역 (Available Zone)`이라 불리는 격리된 위치를 여러개 가지고 있다.

#### (2) 루트 디바이스 저장소 Root Device Storage
`루트 디바이스 저장소`는 `인스턴스`의 부팅에 사용되는 저장소로, 
어떤 저장소를 선택하느냐에 따라 데이터 유지 안정성, 용량이 달라진다. 
기본적으로 `Amazon Instance Store`와 `Amazon Elastic Block Store (Amazon EBS)` 중 하나를 선택해야 한다.

`Amazon Instance Store`는 호스트 컴퓨터에 물리적으로 연결된 디스크 저장소를 이용한다.
`인스턴스`의 수명 기간 동안에만 유지되며, `인스턴스`를 중단하거나 종료하면 데이터가 손실된다.

`Amazon EBS`는 영구 저장소로, `인스턴스`의 수명에 상관없이 데이터가 유지된다.
`인스턴스`가 중지되거나 종료되면 데이터 유지 혹은 삭제를 유저가 선택해 진행할 수 있다.
따라서 데이터 베이스를 구축하기 위한 인스턴스를 생성할 때 주로 사용된다.
`Amazon EBS`는 호스트 컴퓨 외부에 존재하는 저장소이기 때문에 외장 하드 디스크와 같이 기능하여,
`인스턴스` 생성 후에도 별도로 추가하여 저장소로 활용할 수 있다.
이렇게 추가한 저장소는 추후 분리해 다른 인스턴스에 연결할 수도 있다.

---

### 3. Virtual Private Clouds(VPC)
EC2의 네트워크 계층으로, 사용자 AWS 계정 전용 가상 네트워크이다.

#### (1) Virtual Private Network (VPN)
`VPC`를 잘 이해하기 위해서는 `VPN`에 대한 지식이 있어야 한다.

본래의 `VPN`은 지리적으로 멀리 떨어져 있어 목적으로 하는 내부 네트워크(인트라넷)에 접속할 수 없는 기기에 대해,
인터넷 네트워크를 이용해 데이터를 주고 받을 수 있게 하기 위해 만들어졌다.
이 과정에서 데이터를 보호하기 위해 보안 시스템을 만들었고,
외부에서 인식할 수 없게 되니 마치 내부 네트워크로 연결된 것 같은 효과를 갖게 되었다.
즉, `VPN 라우터`는 인터넷과 인트라넷 사이를 중계하며, 동시에 그 통신 기록을 암호화한다.

따라서 `VPN`을 이용하면 다른 네트워크 상에 있어도 같은 네트워크에 있는 것처럼 만들 수도 있고(논리적 연결),
같은 네트워크 상에 있어도 다른 네트워크에 있는 것처럼 만들 수도 있다(논리적 격리).
실제로 랜선으로 내부의 네트워크 망을 구성하는 것은 아니지만,
인터넷 네트워크를 이용해 가상의 내부 네트워크를 형성하는 것이다.

#### (2) Virtual Private Cloud (VPC)
`VPC`는 AWS 계정을 생성할 때 자동으로 `리전`마다 만들어지는 계정 전용의 `VPN`이라고 할 수 있다.
계정에서 생성한 리소스들의 내부 네트워크를 만들어주기 때문에,
다른 사람들이 내부 정보에 접근할 수 없게 된다.

`VPC`는 정해진 IP 주소 대역을 갖는다.
이는 `VPC` 내부에서만 서로를 인식하기 위해 만들어진 Private IP 주소이다.
대역은 `CIDR 블록` 방식으로 주어지며, 그 형태는 아래와 같다.

`IP주소` + `/` + `넷마스크`

`넷마스크`는 대역의 크기를 나타내는 숫자인데,
그 값이 n 이라면 대역의 크기는 2 <sup>32-n</sup> 이다.   
예를 들어 아이피 대역이 172.20.0.0/16 이라면 2 <sup>32-16</sup> = 256 x 256 이므로
IP 대역은 172.20.0.0 ~ 172.20.256.256 이다.

### (3) 서브넷 Subnet
`서브넷`은 `VPC`를 더 작은 단위로 쪼개어 만든 네트워크망이다.
한 계정 내에서도 연관된 `인스턴스`끼리의 네트워크망을 분리해 만들기 위해 도입되었다.
`VPC`의 아이피 대역 예시에서 이어 간다면, `서브넷`의 아래와 같은 형태로 IP 대역을 가질 수 있다.

172.20.256.0/24 (172.20.256.0 ~ 172.20.256.256)

앞의 `리전` 설명에서 잠시 언급했던 `가용 영역` 하나당 하나의 `서브넷`을 할당할 수 있다.
그리고 `서브넷` 안에 하나 이상의 `인스턴스`를 포함시킬 수 있다.

### (4) 라우터와 인터넷 게이트웨이
하나의 `VPC` 안에 존재하는 여러개의 `서브넷`사이를 연결해주는 하나의 라우터가 존재한다.
네트워크 요청이 발생하면 라우터에서 정해진 규칙(라우팅 테이블)에 따라 목적지를 판별하고 데이터를 전송한다.
만약 목적지가 `VPC`의 IP 대역 내에 없다면, 외부로 데이터를 보내야한다.
이 역할을 하기 위해 `인터넷 게이트웨이`가 존재한다.

![ec2-vpc](/assets/images/post-contents/ec2-vpc.png)

---

### 4. 보안
#### (1) 키 페어 로그인
`인스턴스`에 연결하기 위해 자격 증명 입증을 할 때,
`퍼블릭 키`와 `프라이빗 키`로 이루어진 `키페어`를 사용한다.
`키페어` 생성 권한이 있는 관리자 `키페어`를 생성하거나 등록할 수 있다.
`퍼블릭 키`는 `인스턴스`에 저장되며, `프라이빗 키`는 사용자가 저장한다.

#### (2) 보안 그룹
`보안 그룹`은 네트워크 보안을 위한 기능으로, `인스턴스`에 대한 수신 및 발신 트래픽을 세부적으로 제어하는 기능이다.
수신 트래픽은 인바운드 규칙을 설정함으로써, 발신 트래픽은 아웃바운드 규칙을 설정함으로써 제어할 수 있다.
어떤 트래픽을 허용할 것인지, http, https, ssh 등 유형을 지정할 수 있고 프로토콜, 포트, IP도 세부적으로 지정하여 허용할 수 있다.
따로 `보안 그룹`을 지정하지 않을 경우, 기본 `보안 그룹`이 사용된다.

#### (3) 네트워크 ACL
`보안 그룹`이 `인스턴스` 단에서의 제어하면, `네트워크 ACL`은 `서브넷` 단에서의 제어이다.
허용, 거부 규칙을 모두 지정할 수 있다.
`네트워크 ACL`과 `보안 그룹`의 설정이 충돌한다면, `보안 그룹`의 설정을 우선으로 따른다.

---

### 5. 탄력적 IP Elastic IP (EIP)
`인스턴스`를 재부팅하면 `VPC`의 퍼블릭 IP 주소가 새로 할당된다.
이를 고정시키기 위해 도입한 것이 `EIP`이다.
AWS 계정마다 기본적으로 하나의 정적 IP를 발급받을 수 있으며,
실행중인 `인스턴스` 혹은 타겟 `인스턴스`들이 속한 특정 네트워크 경계 그룹에 매핑할 수 있다.
추가로 `EIP`를 발급하려면 요금이 발생하며,
`EIP`의 효율적인 사용을 위해서 발급한 `EIP`가 실행 중인 인스턴스와 연결되어 있지 않아도 요금이 부과된다.


---
### 출처

[AWS 공식문서](https://docs.aws.amazon.com)   
[가장 쉽게 VPC 개념잡기](https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098)
